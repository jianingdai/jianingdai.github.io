<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/cat.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cat.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cat.png">
  <link rel="mask-icon" href="/images/cat.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jianingdai.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeIn","post_block":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","sidebar":"fadeIn"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="基于ai问答和改进设计的企业圈系统设计文档，仅供参考">
<meta property="og:type" content="article">
<meta property="og:title" content="企业圈系统设计">
<meta property="og:url" content="http://jianingdai.github.io/2025/08/21/%E4%BC%81%E4%B8%9A%E5%9C%88%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1(todo)/index.html">
<meta property="og:site_name" content="摸鱼日记">
<meta property="og:description" content="基于ai问答和改进设计的企业圈系统设计文档，仅供参考">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281428715.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281429118.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281433768.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281434001.png">
<meta property="article:published_time" content="2025-08-21T08:17:39.000Z">
<meta property="article:modified_time" content="2025-08-28T06:36:54.162Z">
<meta property="article:author" content="jianing dai">
<meta property="article:tag" content="Golang">
<meta property="article:tag" content="后端开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281428715.png">


<link rel="canonical" href="http://jianingdai.github.io/2025/08/21/%E4%BC%81%E4%B8%9A%E5%9C%88%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1(todo)/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://jianingdai.github.io/2025/08/21/%E4%BC%81%E4%B8%9A%E5%9C%88%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1(todo)/","path":"2025/08/21/企业圈系统设计(todo)/","title":"企业圈系统设计"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>企业圈系统设计 | 摸鱼日记</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?b765f5fe044fded4f27d9306bd7367a2"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">摸鱼日记</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>个人主页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa-solid fa-inbox fa-fw"></i>所有文章</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%81%E4%B8%9A%E5%9C%88%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3"><span class="nav-text">企业圈系统设计文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80"><span class="nav-text">一、引言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E5%8F%98%E6%9B%B4%E6%97%A5%E5%BF%97"><span class="nav-text">文档变更日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="nav-text">二、项目概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF"><span class="nav-text">2.1 需求背景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1"><span class="nav-text">三、详细设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.1 系统架构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E7%B3%BB%E7%BB%9F%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="nav-text">3.1.1 系统整体架构图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="nav-text">3.1.2 核心业务流程时序图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E6%99%BA%E8%83%BD%E7%BD%AE%E9%A1%B6%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-text">3.1.3 智能置顶算法流程图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.2 数据库设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-%E6%95%B0%E6%8D%AE%E5%BA%93ER%E5%9B%BE"><span class="nav-text">3.2.1 数据库ER图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%AD%96%E7%95%A5"><span class="nav-text">3.2.2 分库分表策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E4%BC%81%E4%B8%9A%E8%A1%A8-enterprises"><span class="nav-text">3.2.3 企业表 (enterprises)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-%E7%94%A8%E6%88%B7%E8%A1%A8-users"><span class="nav-text">3.2.4 用户表 (users)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-%E4%BC%81%E4%B8%9A%E5%9C%88%E5%86%85%E5%AE%B9%E8%A1%A8-posts"><span class="nav-text">3.2.5 企业圈内容表 (posts)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-6-%E7%82%B9%E8%B5%9E%E8%A1%A8-likes"><span class="nav-text">3.2.6 点赞表 (likes)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-7-%E8%AF%84%E8%AE%BA%E8%A1%A8-comments"><span class="nav-text">3.2.7 评论表 (comments)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-8-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93"><span class="nav-text">3.2.8 数据库设计总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.3 系统功能设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">3.3.1 用户认证与权限管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E4%BC%81%E4%B8%9A%E5%9C%88%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86"><span class="nav-text">3.3.2 企业圈内容管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-%E6%99%BA%E8%83%BD%E7%82%B9%E8%B5%9E%E7%B3%BB%E7%BB%9F"><span class="nav-text">3.3.3 智能点赞系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-%E6%99%BA%E8%83%BD%E7%BD%AE%E9%A1%B6%E7%AE%97%E6%B3%95%E7%B3%BB%E7%BB%9F"><span class="nav-text">3.3.4 智能置顶算法系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-5-%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F"><span class="nav-text">3.3.5 评论系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-6-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.3.6 缓存策略设计</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.4 接口设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E6%8E%A5%E5%8F%A3"><span class="nav-text">3.4.1 用户认证接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C"><span class="nav-text">用户注册</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="nav-text">用户登录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C"><span class="nav-text">刷新令牌</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%87%BA"><span class="nav-text">用户登出</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-%E4%BC%81%E4%B8%9A%E5%9C%88%E5%86%85%E5%AE%B9%E6%8E%A5%E5%8F%A3"><span class="nav-text">3.4.2 企业圈内容接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E5%86%85%E5%AE%B9"><span class="nav-text">发布内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E4%BC%81%E4%B8%9A%E5%9C%88%E5%8A%A8%E6%80%81"><span class="nav-text">获取企业圈动态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%8D%95%E4%B8%AA%E5%86%85%E5%AE%B9%E8%AF%A6%E6%83%85"><span class="nav-text">获取单个内容详情</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E5%86%85%E5%AE%B9"><span class="nav-text">编辑内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%86%85%E5%AE%B9"><span class="nav-text">删除内容</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-%E7%82%B9%E8%B5%9E%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3"><span class="nav-text">3.4.3 点赞相关接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%82%B9%E8%B5%9E-%E5%8F%96%E6%B6%88%E7%82%B9%E8%B5%9E"><span class="nav-text">点赞&#x2F;取消点赞</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%82%B9%E8%B5%9E%E5%88%97%E8%A1%A8"><span class="nav-text">获取点赞列表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%A3%80%E6%9F%A5%E7%82%B9%E8%B5%9E%E7%8A%B6%E6%80%81"><span class="nav-text">批量检查点赞状态</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-4-%E8%AF%84%E8%AE%BA%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3"><span class="nav-text">3.4.4 评论相关接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%91%E8%A1%A8%E8%AF%84%E8%AE%BA"><span class="nav-text">发表评论</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="nav-text">获取评论列表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%9E%E5%A4%8D%E8%AF%84%E8%AE%BA"><span class="nav-text">回复评论</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%84%E8%AE%BA%E7%82%B9%E8%B5%9E"><span class="nav-text">评论点赞</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%AF%84%E8%AE%BA"><span class="nav-text">删除评论</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-5-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3"><span class="nav-text">3.4.5 文件上传接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0"><span class="nav-text">图片上传</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E4%B8%8A%E4%BC%A0"><span class="nav-text">视频上传</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-6-%E7%BB%9F%E8%AE%A1%E6%8E%A5%E5%8F%A3"><span class="nav-text">3.4.6 统计接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E4%BC%81%E4%B8%9A%E5%9C%88%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-text">获取企业圈统计数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%AA%E4%BA%BA%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-text">获取个人统计数据</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-7-%E9%80%9A%E7%94%A8%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F"><span class="nav-text">3.4.7 通用响应格式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.5 部署架构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="nav-text">3.5.1 容器化部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-%E7%9B%91%E6%8E%A7%E9%83%A8%E7%BD%B2"><span class="nav-text">3.5.2 监控部署</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9"><span class="nav-text">四、技术实现要点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="nav-text">4.1 高并发优化策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-%E5%88%86%E5%B1%82%E7%BC%93%E5%AD%98%E4%BD%93%E7%B3%BB"><span class="nav-text">4.1.1 分层缓存体系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="nav-text">4.1.2 数据库集群架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E6%9E%B6%E6%9E%84"><span class="nav-text">4.1.3 异步处理架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BC%98%E5%8C%96"><span class="nav-text">4.1.4 连接池优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E4%BF%9D%E9%9A%9C"><span class="nav-text">4.2 数据一致性保障</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0"><span class="nav-text">4.2.1 分布式锁实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7%E6%96%B9%E6%A1%88"><span class="nav-text">4.2.2 最终一致性方案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%91%8A%E8%AD%A6"><span class="nav-text">4.3 性能监控与告警</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-%E5%85%B3%E9%94%AE%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-text">4.3.1 关键指标监控</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-%E4%B8%9A%E5%8A%A1%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="nav-text">4.3.2 业务监控指标</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E5%AE%89%E5%85%A8%E6%80%A7%E8%AE%BE%E8%AE%A1"><span class="nav-text">4.4 安全性设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-%E8%AE%A4%E8%AF%81%E5%AE%89%E5%85%A8"><span class="nav-text">4.4.1 认证安全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8"><span class="nav-text">4.4.2 数据安全</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E9%99%84%E5%BD%95"><span class="nav-text">五、附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="nav-text">5.1 名词解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">5.2 参考资料</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jianing dai"
      src="/images/cat.png">
  <p class="site-author-name" itemprop="name">jianing dai</p>
  <div class="site-description" itemprop="description">Hello World! :)</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jianingdai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jianingdai" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jianing.dai@whu.edu.cn" title="E-Mail → mailto:jianing.dai@whu.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jianingdai.github.io/2025/08/21/%E4%BC%81%E4%B8%9A%E5%9C%88%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1(todo)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat.png">
      <meta itemprop="name" content="jianing dai">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摸鱼日记">
      <meta itemprop="description" content="Hello World! :)">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="企业圈系统设计 | 摸鱼日记">
      <meta itemprop="description" content="基于ai问答和改进设计的企业圈系统设计文档，仅供参考">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          企业圈系统设计
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">提交于</span>

      <time title="创建时间：2025-08-21 16:17:39" itemprop="dateCreated datePublished" datetime="2025-08-21T16:17:39+08:00">2025-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-08-28 14:36:54" itemprop="dateModified" datetime="2025-08-28T14:36:54+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">后端开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2025/08/21/%E4%BC%81%E4%B8%9A%E5%9C%88%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1(todo)/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2025/08/21/企业圈系统设计(todo)/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

            <div class="post-description">基于ai问答和改进设计的企业圈系统设计文档，仅供参考</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">根据需求，出一份符合规范的设计文档。</span><br><span class="line"></span><br><span class="line"># 需求</span><br><span class="line">仿造微信朋友圈，设计并实现以下能力：</span><br><span class="line">- **需求1**： 企业用户可以发布或删除企业圈内容</span><br><span class="line">- **需求2** 同企业成员互相可见</span><br><span class="line">- **需求3**支持点赞企业圈内容，24小时内发布且点赞数超过10的企业圈内容中，点赞数前三的自动置顶，置顶的内容按点赞数高到低排序</span><br><span class="line">- **需求4** (可选)支持企业圈内容评论</span><br><span class="line"></span><br><span class="line">参考数据</span><br><span class="line">- **企业数量**：1w</span><br><span class="line">- **每日新增内容**：50w条</span><br><span class="line">- **日活用户数**：500w</span><br><span class="line"></span><br><span class="line"># 设计文档规范</span><br><span class="line">## 文档结构</span><br><span class="line">```</span><br><span class="line">一、 引言</span><br><span class="line">文档变更日志 </span><br><span class="line">二、 项目概述 </span><br><span class="line">2.1 需求背景</span><br><span class="line">三、详细设计</span><br><span class="line">3.1 系统架构设计</span><br><span class="line">系统架构设计图，当涉及到多模块架构时，需按总系统架构图-&gt;各子模块系统架构图的层级关系表示</span><br><span class="line">    3.1.1系统架构图</span><br><span class="line">    3.1.2子模块1架构图</span><br><span class="line">    3.1.3子模块2架构图</span><br><span class="line">3.2 数据库设计</span><br><span class="line">3.3 系统功能设计</span><br><span class="line">3.4 接口设计</span><br><span class="line">五、附录</span><br><span class="line">5.1 名词解释 </span><br><span class="line">4.2 参考资料</span><br><span class="line">参考资料链接列表</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"># 技术选型</span><br><span class="line">- **编程语言**： golang</span><br><span class="line">- **网络框架**：gin</span><br><span class="line">- **数据库**： mysql</span><br><span class="line"></span><br><span class="line"># 注意！</span><br><span class="line">- 设计文档请严格按照规范输出</span><br><span class="line">- 流程图格式使用 mermaid 绘制</span><br><span class="line">- 注意，请认真阅读4个需求，接口和数据库设计都必须要实现</span><br><span class="line">- 文档内容要足够清晰详细，前端需要看接口文档对接联通，测试需要看文档写测试用例</span><br><span class="line">- 你的所有回答、方案、实现都需要谨慎、专业、深入的思考。</span><br></pre></td></tr></table></figure>

<h1 id="企业圈系统设计文档"><a href="#企业圈系统设计文档" class="headerlink" title="企业圈系统设计文档"></a>企业圈系统设计文档</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>本设计文档描述了企业圈系统的整体架构设计、数据库设计、功能模块设计以及API接口设计。该系统旨在为企业内部员工提供类似微信朋友圈的社交功能，支持企业内容发布、点赞、评论等功能，并通过智能置顶算法提升优质内容的曝光度。</p>
<h3 id="文档变更日志"><a href="#文档变更日志" class="headerlink" title="文档变更日志"></a>文档变更日志</h3><table>
<thead>
<tr>
<th><em><strong>*版本*</strong></em></th>
<th><em><strong>*变更日期*</strong></em></th>
<th><em><strong>*变更内容*</strong></em></th>
<th><em><strong>*变更人*</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td>v1.0</td>
<td>2024-12-19</td>
<td>初始版本，包含系统架构、数据库设计、API设计</td>
<td>系统架构师</td>
</tr>
<tr>
<td>v1.1</td>
<td>2024-12-19</td>
<td>优化架构图为Mermaid格式，完善技术实现细节</td>
<td>系统架构师</td>
</tr>
</tbody></table>
<h2 id="二、项目概述"><a href="#二、项目概述" class="headerlink" title="二、项目概述"></a>二、项目概述</h2><h3 id="2-1-需求背景"><a href="#2-1-需求背景" class="headerlink" title="2.1 需求背景"></a>2.1 需求背景</h3><p>随着企业数字化转型的推进，企业内部员工之间的信息交流和协作需求日益增长。传统的企业内部沟通方式往往缺乏互动性和即时性，难以满足现代企业的沟通需求。</p>
<p>本项目旨在构建一个企业级的内部社交平台，具体实现以下核心需求：</p>
<p>****核心功能需求****：</p>
<ol>
<li>****内容管理****：企业用户可以发布或删除企业圈内容</li>
<li>****权限控制****：同企业成员互相可见，跨企业内容隔离</li>
<li>****智能置顶****：24小时内发布且点赞数超过10的内容中，点赞数前三的自动置顶</li>
<li>****互动功能****：支持企业圈内容评论，增强用户互动</li>
</ol>
<p>****系统规模指标****：</p>
<ul>
<li>****企业数量****：10,000家企业</li>
<li>****每日新增内容****：500,000条</li>
<li>****日活用户数****：5,000,000人</li>
<li>****峰值QPS预估****：~15,000 QPS（考虑高峰时段集中访问）</li>
<li>****存储预估****：每日新增约100GB数据（包含文本、图片、元数据等）</li>
</ul>
<h2 id="三、详细设计"><a href="#三、详细设计" class="headerlink" title="三、详细设计"></a>三、详细设计</h2><h3 id="3-1-系统架构设计"><a href="#3-1-系统架构设计" class="headerlink" title="3.1 系统架构设计"></a>3.1 系统架构设计</h3><h4 id="3-1-1-系统整体架构图"><a href="#3-1-1-系统整体架构图" class="headerlink" title="3.1.1 系统整体架构图"></a>3.1.1 系统整体架构图</h4><p>系统采用微服务架构，分为客户端层、网关层、应用服务层、数据存储层和基础设施层。通过水平分层和垂直拆分，确保系统的高可用性和可扩展性。</p>
<p><img data-src="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281428715.png" alt="image-20250828142839440"></p>
<pre class="mermaid">graph TB
    subgraph "客户端层"
        WebClient["Web客户端"]
        MobileApp["移动端APP"]
        ThirdParty["第三方应用"]
    end
    
    subgraph "网关层"
        Gateway["API网关<br/>负载均衡<br/>限流熔断"]
    end
    
    subgraph "应用服务层"
        AuthService["认证服务<br/>- 用户登录注册<br/>- JWT令牌管理<br/>- 权限验证"]
        ContentService["内容服务<br/>- 企业圈CRUD<br/>- 动态Feed生成<br/>- 置顶算法"]
        LikeService["点赞服务<br/>- 点赞/取消<br/>- 计数统计<br/>- 热度计算"]
        CommentService["评论服务<br/>- 评论CRUD<br/>- 二级回复<br/>- 内容审核"]
    end
    
    subgraph "数据存储层"
        MySQL["MySQL集群<br/>- 主从分离<br/>- 分库分表<br/>- 读写分离"]
        Redis["Redis集群<br/>- 缓存热点数据<br/>- 计数器<br/>- 分布式锁"]
        FileStorage["文件存储<br/>- 图片存储<br/>- CDN加速"]
    end
    
    subgraph "基础设施层"
        MQ["消息队列<br/>- 异步处理<br/>- 削峰填谷"]
        Monitor["监控告警<br/>- 性能监控<br/>- 业务监控"]
        Schedule["定时任务<br/>- 置顶更新<br/>- 数据同步"]
    end
    
    WebClient --> Gateway
    MobileApp --> Gateway
    ThirdParty --> Gateway
    
    Gateway --> AuthService
    Gateway --> ContentService
    Gateway --> LikeService
    Gateway --> CommentService
    
    AuthService --> MySQL
    AuthService --> Redis
    
    ContentService --> MySQL
    ContentService --> Redis
    ContentService --> FileStorage
    ContentService --> MQ
    
    LikeService --> MySQL
    LikeService --> Redis
    LikeService --> MQ
    
    CommentService --> MySQL
    CommentService --> Redis
    
    MQ --> Schedule
    Schedule --> ContentService
    
    Monitor --> AuthService
    Monitor --> ContentService
    Monitor --> LikeService
    Monitor --> CommentService</pre>

<h4 id="3-1-2-核心业务流程时序图"><a href="#3-1-2-核心业务流程时序图" class="headerlink" title="3.1.2 核心业务流程时序图"></a>3.1.2 核心业务流程时序图</h4><p>主要展示用户登录、内容发布、点赞等核心业务流程的交互时序。</p>
<p><img data-src="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281429118.png" alt="image-20250828142944999"></p>
<pre class="mermaid">sequenceDiagram
    participant Client as 客户端
    participant Gateway as API网关
    participant Auth as 认证服务
    participant Content as 内容服务
    participant Like as 点赞服务
    participant MySQL as MySQL数据库
    participant Redis as Redis缓存

    Note over Client,Redis: 用户登录流程
    Client->>Gateway: POST /api/v1/auth/login
    Gateway->>Auth: 转发登录请求
    Auth->>MySQL: 验证用户凭证
    MySQL-->>Auth: 返回用户信息
    Auth->>Redis: 缓存用户会话
    Auth-->>Gateway: 返回JWT令牌
    Gateway-->>Client: 登录成功响应

    Note over Client,Redis: 发布内容流程
    Client->>Gateway: POST /api/v1/posts
    Gateway->>Auth: 验证JWT令牌
    Auth-->>Gateway: 令牌有效
    Gateway->>Content: 转发发布请求
    Content->>MySQL: 插入内容记录
    MySQL-->>Content: 插入成功
    Content->>Redis: 更新Feed缓存
    Content-->>Gateway: 发布成功
    Gateway-->>Client: 返回成功响应

    Note over Client,Redis: 点赞流程
    Client->>Gateway: POST /api/v1/posts/{id}/like
    Gateway->>Auth: 验证权限
    Auth-->>Gateway: 权限验证通过
    Gateway->>Like: 处理点赞请求
    Like->>Redis: 检查点赞状态
    Redis-->>Like: 返回当前状态
    Like->>MySQL: 更新点赞记录
    Like->>Redis: 更新点赞计数
    Like->>Content: 异步检查置顶条件
    Like-->>Gateway: 点赞操作完成
    Gateway-->>Client: 返回操作结果</pre>

<h4 id="3-1-3-智能置顶算法流程图"><a href="#3-1-3-智能置顶算法流程图" class="headerlink" title="3.1.3 智能置顶算法流程图"></a>3.1.3 智能置顶算法流程图</h4><p>展示自动置顶机制的具体执行流程，确保24小时内高质量内容能够获得更多曝光。</p>
<p><img data-src="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281433768.png" alt="mermaid-diagram-2025-08-28-143154"></p>
<pre class="mermaid">flowchart TD
    A[定时任务启动<br/>每小时执行] --> B[获取所有企业列表]
    B --> C{遍历每个企业}
    C --> D[查询24小时内<br/>点赞数>10的内容]
    D --> E{是否有符合条件的内容?}
    E -->|否| F[清空当前置顶内容]
    E -->|是| G[按点赞数降序排序]
    G --> H[取前3名内容]
    H --> I[清空旧置顶状态]
    I --> J[设置新置顶内容]
    J --> K[更新is_pinned=1<br/>设置pinned_at时间]
    K --> L[清理Redis置顶缓存]
    L --> M[预热新置顶内容到缓存]
    F --> N[继续下一个企业]
    M --> N
    N --> C
    C -->|所有企业处理完成| O[任务完成<br/>等待下次执行]
    
    style A fill:#e1f5fe
    style O fill:#c8e6c9
    style K fill:#fff3e0</pre>

<h3 id="3-2-数据库设计"><a href="#3-2-数据库设计" class="headerlink" title="3.2 数据库设计"></a>3.2 数据库设计</h3><h4 id="3-2-1-数据库ER图"><a href="#3-2-1-数据库ER图" class="headerlink" title="3.2.1 数据库ER图"></a>3.2.1 数据库ER图</h4><p>系统核心实体关系图，展示企业、用户、内容、点赞、评论之间的关联关系。</p>
<p><img data-src="https://raw.githubusercontent.com/jianingdai/Blog_img/main/img202508281434001.png" alt="mermaid-diagram-2025-08-28-143437"></p>
<pre class="mermaid">erDiagram
    enterprises {
        bigint id PK "企业ID"
        varchar name "企业名称"
        varchar code "企业代码"
        varchar logo "企业logo"
        tinyint status "状态"
        timestamp created_at "创建时间"
        timestamp updated_at "更新时间"
    }
    
    users {
        bigint id PK "用户ID"
        bigint enterprise_id FK "企业ID"
        varchar username "用户名"
        varchar email "邮箱"
        varchar nickname "昵称"
        varchar avatar "头像URL"
        varchar password_hash "密码哈希"
        tinyint status "状态"
        timestamp created_at "创建时间"
        timestamp updated_at "更新时间"
    }
    
    posts {
        bigint id PK "内容ID"
        bigint user_id FK "发布用户ID"
        bigint enterprise_id FK "企业ID"
        text content "内容文本"
        json images "图片URL列表"
        int like_count "点赞数"
        int comment_count "评论数"
        tinyint is_pinned "是否置顶"
        timestamp pinned_at "置顶时间"
        tinyint status "状态"
        timestamp created_at "创建时间"
        timestamp updated_at "更新时间"
    }
    
    likes {
        bigint id PK "点赞ID"
        bigint post_id FK "内容ID"
        bigint user_id FK "用户ID"
        timestamp created_at "点赞时间"
    }
    
    comments {
        bigint id PK "评论ID"
        bigint post_id FK "内容ID"
        bigint user_id FK "评论用户ID"
        bigint parent_id FK "父评论ID"
        text content "评论内容"
        tinyint status "状态"
        timestamp created_at "创建时间"
        timestamp updated_at "更新时间"
    }
    
    enterprises ||--o{ users : "包含"
    enterprises ||--o{ posts : "拥有"
    users ||--o{ posts : "发布"
    users ||--o{ likes : "点赞"
    users ||--o{ comments : "评论"
    posts ||--o{ likes : "被点赞"
    posts ||--o{ comments : "被评论"
    comments ||--o{ comments : "回复"</pre>

<h4 id="3-2-2-分库分表策略"><a href="#3-2-2-分库分表策略" class="headerlink" title="3.2.2 分库分表策略"></a>3.2.2 分库分表策略</h4><p>****分表策略****：</p>
<ul>
<li>按企业ID进行分表，每个企业的数据存储在独立的表中</li>
<li>分表规则：<code>posts_$&#123;enterprise_id % 100&#125;</code></li>
<li>支持最大10,000个企业，平均每表100个企业</li>
</ul>
<p>****索引优化策略****：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 企业圈动态查询优化索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_posts_enterprise_created <span class="keyword">ON</span> posts_$&#123;shard&#125; (enterprise_id, created_at <span class="keyword">DESC</span>, status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 置顶内容查询优化索引  </span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_posts_pinned_likes <span class="keyword">ON</span> posts_$&#123;shard&#125; (enterprise_id, is_pinned <span class="keyword">DESC</span>, like_count <span class="keyword">DESC</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 24小时热门内容查询索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_posts_hot_24h <span class="keyword">ON</span> posts_$&#123;shard&#125; (enterprise_id, created_at, like_count, status);</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-企业表-enterprises"><a href="#3-2-3-企业表-enterprises" class="headerlink" title="3.2.3 企业表 (enterprises)"></a>3.2.3 企业表 (enterprises)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `enterprises` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;企业ID&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;企业名称&#x27;</span>,</span><br><span class="line">  `code` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;企业代码&#x27;</span>,</span><br><span class="line">  `logo` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;企业logo&#x27;</span>,</span><br><span class="line">  `description` text <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;企业描述&#x27;</span>,</span><br><span class="line">  `industry` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;所属行业&#x27;</span>,</span><br><span class="line">  `employee_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;员工数量&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态: 1-正常, 0-禁用&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_code` (`code`),</span><br><span class="line">  KEY `idx_name` (`name`),</span><br><span class="line">  KEY `idx_status` (`status`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;企业表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-用户表-users"><a href="#3-2-4-用户表-users" class="headerlink" title="3.2.4 用户表 (users)"></a>3.2.4 用户表 (users)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  `enterprise_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;企业ID&#x27;</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">  `password_hash` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码哈希&#x27;</span>,</span><br><span class="line">  `nickname` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">  `avatar` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;头像URL&#x27;</span>,</span><br><span class="line">  `department` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;部门&#x27;</span>,</span><br><span class="line">  `position` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;职位&#x27;</span>,</span><br><span class="line">  `phone` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">  `last_login_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后登录时间&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态: 1-正常, 0-禁用&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_username` (`username`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_email` (`email`),</span><br><span class="line">  KEY `idx_enterprise_id` (`enterprise_id`),</span><br><span class="line">  KEY `idx_status` (`status`),</span><br><span class="line">  KEY `idx_last_login` (`last_login_at`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_users_enterprise` <span class="keyword">FOREIGN</span> KEY (`enterprise_id`) <span class="keyword">REFERENCES</span> `enterprises` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-企业圈内容表-posts"><a href="#3-2-5-企业圈内容表-posts" class="headerlink" title="3.2.5 企业圈内容表 (posts)"></a>3.2.5 企业圈内容表 (posts)</h4><p>支持分表存储，按企业ID取模分布到不同表中，提升查询性能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">-- 分表模板，实际会创建 posts_0 到 posts_99 共100个表</span><br><span class="line">CREATE TABLE `posts_$&#123;shard&#125;` (</span><br><span class="line">  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#x27;内容ID&#x27;,</span><br><span class="line">  `user_id` bigint(20) unsigned NOT NULL COMMENT &#x27;发布用户ID&#x27;,</span><br><span class="line">  `enterprise_id` bigint(20) unsigned NOT NULL COMMENT &#x27;企业ID&#x27;,</span><br><span class="line">  `content` text NOT NULL COMMENT &#x27;内容文本&#x27;,</span><br><span class="line">  `images` json DEFAULT NULL COMMENT &#x27;图片URL列表&#x27;,</span><br><span class="line">  `video_url` varchar(255) DEFAULT &#x27;&#x27; COMMENT &#x27;视频URL&#x27;,</span><br><span class="line">  `location` varchar(200) DEFAULT &#x27;&#x27; COMMENT &#x27;发布位置&#x27;,</span><br><span class="line">  `tags` json DEFAULT NULL COMMENT &#x27;标签列表&#x27;,</span><br><span class="line">  `like_count` int(11) DEFAULT 0 COMMENT &#x27;点赞数&#x27;,</span><br><span class="line">  `comment_count` int(11) DEFAULT 0 COMMENT &#x27;评论数&#x27;,</span><br><span class="line">  `share_count` int(11) DEFAULT 0 COMMENT &#x27;分享数&#x27;,</span><br><span class="line">  `view_count` int(11) DEFAULT 0 COMMENT &#x27;浏览数&#x27;,</span><br><span class="line">  `is_pinned` tinyint(1) DEFAULT 0 COMMENT &#x27;是否置顶: 1-是, 0-否&#x27;,</span><br><span class="line">  `pinned_at` timestamp NULL DEFAULT NULL COMMENT &#x27;置顶时间&#x27;,</span><br><span class="line">  `pinned_order` int(11) DEFAULT 0 COMMENT &#x27;置顶排序: 1,2,3&#x27;,</span><br><span class="line">  `status` tinyint(1) DEFAULT 1 COMMENT &#x27;状态: 1-正常, 0-删除&#x27;,</span><br><span class="line">  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_user_enterprise` (`user_id`, `enterprise_id`),</span><br><span class="line">  KEY `idx_enterprise_created` (`enterprise_id`, `created_at` DESC, `status`),</span><br><span class="line">  KEY `idx_enterprise_pinned` (`enterprise_id`, `is_pinned` DESC, `like_count` DESC),</span><br><span class="line">  KEY `idx_hot_content_24h` (`enterprise_id`, `created_at`, `like_count`, `status`),</span><br><span class="line">  CONSTRAINT `fk_posts_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`),</span><br><span class="line">  CONSTRAINT `fk_posts_enterprise` FOREIGN KEY (`enterprise_id`) REFERENCES `enterprises` (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;企业圈内容表&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-6-点赞表-likes"><a href="#3-2-6-点赞表-likes" class="headerlink" title="3.2.6 点赞表 (likes)"></a>3.2.6 点赞表 (likes)</h4><p>支持分表存储，与posts表采用相同的分片策略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分表模板，与posts表保持一致的分片策略</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `likes_$&#123;shard&#125;` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;点赞ID&#x27;</span>,</span><br><span class="line">  `post_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;内容ID&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  `enterprise_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;企业ID&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;点赞时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_post_user` (`post_id`, `user_id`),</span><br><span class="line">  KEY `idx_user_enterprise` (`user_id`, `enterprise_id`),</span><br><span class="line">  KEY `idx_post_created` (`post_id`, `created_at`),</span><br><span class="line">  KEY `idx_enterprise_created` (`enterprise_id`, `created_at`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;点赞表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-7-评论表-comments"><a href="#3-2-7-评论表-comments" class="headerlink" title="3.2.7 评论表 (comments)"></a>3.2.7 评论表 (comments)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分表模板，与posts表保持一致的分片策略</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `comments_$&#123;shard&#125;` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;评论ID&#x27;</span>,</span><br><span class="line">  `post_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;内容ID&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评论用户ID&#x27;</span>,</span><br><span class="line">  `enterprise_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;企业ID&#x27;</span>,</span><br><span class="line">  `parent_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;父评论ID,0为顶级评论&#x27;</span>,</span><br><span class="line">  `root_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;根评论ID&#x27;</span>,</span><br><span class="line">  `reply_to_user_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;回复的用户ID&#x27;</span>,</span><br><span class="line">  `content` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评论内容&#x27;</span>,</span><br><span class="line">  `like_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;评论点赞数&#x27;</span>,</span><br><span class="line">  `reply_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;回复数&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态: 1-正常, 0-删除&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_post_id` (`post_id`, `status`, `created_at`),</span><br><span class="line">  KEY `idx_user_enterprise` (`user_id`, `enterprise_id`),</span><br><span class="line">  KEY `idx_parent_id` (`parent_id`),</span><br><span class="line">  KEY `idx_root_id` (`root_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_comments_post` <span class="keyword">FOREIGN</span> KEY (`post_id`) <span class="keyword">REFERENCES</span> `posts_$&#123;shard&#125;` (`id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_comments_user` <span class="keyword">FOREIGN</span> KEY (`user_id`) <span class="keyword">REFERENCES</span> `users` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;评论表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-8-数据库设计总结"><a href="#3-2-8-数据库设计总结" class="headerlink" title="3.2.8 数据库设计总结"></a>3.2.8 数据库设计总结</h4><p>****设计原则****：</p>
<ol>
<li>****数据隔离****：通过enterprise_id实现严格的企业数据隔离</li>
<li>****水平扩展****：采用分表策略支持大规模数据存储</li>
<li>****查询优化****：针对核心查询场景设计复合索引</li>
<li>****数据完整性****：使用外键约束保证数据一致性</li>
<li>****软删除****：重要数据采用status字段实现软删除</li>
</ol>
<p>****核心查询场景及优化****：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 场景1：获取企业圈动态（置顶+普通内容）</span></span><br><span class="line"><span class="comment">-- 查询策略：先查置顶，再查普通，合并结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> posts_$&#123;shard&#125; </span><br><span class="line"><span class="keyword">WHERE</span> enterprise_id <span class="operator">=</span> ? <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> is_pinned <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> like_count <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> posts_$&#123;shard&#125; </span><br><span class="line"><span class="keyword">WHERE</span> enterprise_id <span class="operator">=</span> ? <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> is_pinned <span class="operator">=</span> <span class="number">0</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at <span class="keyword">DESC</span> </span><br><span class="line">LIMIT ? <span class="keyword">OFFSET</span> ?;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 场景2：24小时热门内容查询（置顶算法核心）</span></span><br><span class="line"><span class="keyword">SELECT</span> id, like_count, created_at </span><br><span class="line"><span class="keyword">FROM</span> posts_$&#123;shard&#125; </span><br><span class="line"><span class="keyword">WHERE</span> enterprise_id <span class="operator">=</span> ? </span><br><span class="line">  <span class="keyword">AND</span> created_at <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">24</span> <span class="keyword">HOUR</span>)</span><br><span class="line">  <span class="keyword">AND</span> like_count <span class="operator">&gt;</span> <span class="number">10</span> </span><br><span class="line">  <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> like_count <span class="keyword">DESC</span>, created_at <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 场景3：用户点赞状态批量查询</span></span><br><span class="line"><span class="keyword">SELECT</span> post_id </span><br><span class="line"><span class="keyword">FROM</span> likes_$&#123;shard&#125; </span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="operator">=</span> ? <span class="keyword">AND</span> post_id <span class="keyword">IN</span> (?, ?, ?);</span><br></pre></td></tr></table></figure>

<h3 id="3-3-系统功能设计"><a href="#3-3-系统功能设计" class="headerlink" title="3.3 系统功能设计"></a>3.3 系统功能设计</h3><h4 id="3-3-1-用户认证与权限管理"><a href="#3-3-1-用户认证与权限管理" class="headerlink" title="3.3.1 用户认证与权限管理"></a>3.3.1 用户认证与权限管理</h4><p>****功能描述****：</p>
<ul>
<li>用户注册：企业员工通过企业邀请码注册</li>
<li>用户登录：用户名&#x2F;邮箱 + 密码登录，返回JWT令牌</li>
<li>权限验证：基于企业ID的数据隔离，确保跨企业数据安全</li>
<li>会话管理：JWT令牌有效期管理，支持令牌刷新</li>
</ul>
<p>****技术实现方案****：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AuthService <span class="keyword">struct</span> &#123;</span><br><span class="line">    userRepo     repository.UserRepository</span><br><span class="line">    redisClient  redis.Client</span><br><span class="line">    jwtSecret    <span class="type">string</span></span><br><span class="line">    tokenExpiry  time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户登录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *AuthService)</span></span> Login(ctx context.Context, req *LoginRequest) (*LoginResponse, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 验证用户凭证</span></span><br><span class="line">    user, err := s.userRepo.GetByUsername(ctx, req.Username)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> || !s.verifyPassword(req.Password, user.PasswordHash) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;用户名或密码错误&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 生成JWT令牌</span></span><br><span class="line">    token, err := s.generateJWT(user.ID, user.EnterpriseID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 缓存用户会话信息</span></span><br><span class="line">    s.cacheUserSession(ctx, user.ID, user)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 更新最后登录时间</span></span><br><span class="line">    s.userRepo.UpdateLastLogin(ctx, user.ID)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &amp;LoginResponse&#123;</span><br><span class="line">        Token: token,</span><br><span class="line">        User:  s.buildUserVO(user),</span><br><span class="line">    &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 企业权限验证中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *AuthService)</span></span> EnterpriseAuthMiddleware() gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        userID := c.GetInt64(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">        enterpriseID := c.GetInt64(<span class="string">&quot;enterprise_id&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从缓存中获取用户信息</span></span><br><span class="line">        user := s.getUserFromCache(c.Request.Context(), userID)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="literal">nil</span> || user.EnterpriseID != enterpriseID &#123;</span><br><span class="line">            c.JSON(<span class="number">403</span>, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;无权访问该企业内容&quot;</span>&#125;)</span><br><span class="line">            c.Abort()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        c.Set(<span class="string">&quot;user&quot;</span>, user)</span><br><span class="line">        c.Next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-企业圈内容管理"><a href="#3-3-2-企业圈内容管理" class="headerlink" title="3.3.2 企业圈内容管理"></a>3.3.2 企业圈内容管理</h4><p>****功能描述****：</p>
<ul>
<li>内容发布：支持文本、图片、视频、位置等多媒体内容</li>
<li>内容删除：用户只能删除自己发布的内容</li>
<li>内容编辑：支持发布后24小时内编辑</li>
<li>动态Feed：获取企业内容动态，置顶内容优先展示</li>
</ul>
<p>****核心业务逻辑****：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ContentService <span class="keyword">struct</span> &#123;</span><br><span class="line">    postRepo     repository.PostRepository</span><br><span class="line">    userRepo     repository.UserRepository</span><br><span class="line">    redisClient  redis.Client</span><br><span class="line">    messageQueue mq.MessageQueue</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布内容</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *ContentService)</span></span> CreatePost(ctx context.Context, req *CreatePostRequest) (*PostVO, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 参数验证</span></span><br><span class="line">    <span class="keyword">if</span> err := s.validateCreateRequest(req); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 构建内容对象</span></span><br><span class="line">    post := &amp;model.Post&#123;</span><br><span class="line">        UserID:       req.UserID,</span><br><span class="line">        EnterpriseID: req.EnterpriseID,</span><br><span class="line">        Content:      req.Content,</span><br><span class="line">        Images:       req.Images,</span><br><span class="line">        VideoURL:     req.VideoURL,</span><br><span class="line">        Location:     req.Location,</span><br><span class="line">        Tags:         req.Tags,</span><br><span class="line">        Status:       <span class="number">1</span>,</span><br><span class="line">        CreatedAt:    time.Now(),</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 数据库写入</span></span><br><span class="line">    shard := s.getShardByEnterpriseID(req.EnterpriseID)</span><br><span class="line">    <span class="keyword">if</span> err := s.postRepo.Create(ctx, shard, post); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 异步更新Feed缓存</span></span><br><span class="line">    s.messageQueue.Publish(<span class="string">&quot;feed.update&quot;</span>, &amp;FeedUpdateMessage&#123;</span><br><span class="line">        PostID:       post.ID,</span><br><span class="line">        EnterpriseID: req.EnterpriseID,</span><br><span class="line">        Action:       <span class="string">&quot;create&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> s.buildPostVO(ctx, post), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取企业圈动态Feed</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *ContentService)</span></span> GetEnterpriseFeed(ctx context.Context, enterpriseID <span class="type">int64</span>, userID <span class="type">int64</span>, page, size <span class="type">int</span>) (*FeedResponse, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 尝试从缓存获取</span></span><br><span class="line">    cacheKey := fmt.Sprintf(<span class="string">&quot;feed:%d:%d:%d&quot;</span>, enterpriseID, page, size)</span><br><span class="line">    <span class="keyword">if</span> cachedFeed := s.getFeedFromCache(ctx, cacheKey); cachedFeed != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cachedFeed, <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 获取置顶内容（仅第一页显示）</span></span><br><span class="line">    <span class="keyword">var</span> pinnedPosts []*model.Post</span><br><span class="line">    <span class="keyword">if</span> page == <span class="number">1</span> &#123;</span><br><span class="line">        pinnedPosts = s.getPinnedPosts(ctx, enterpriseID)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 获取普通内容</span></span><br><span class="line">    shard := s.getShardByEnterpriseID(enterpriseID)</span><br><span class="line">    offset := (page - <span class="number">1</span>) * size</span><br><span class="line">    normalPosts, total, err := s.postRepo.GetByEnterpriseID(ctx, shard, enterpriseID, offset, size)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 合并结果</span></span><br><span class="line">    allPosts := <span class="built_in">append</span>(pinnedPosts, normalPosts...)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 构建响应对象，包含用户点赞状态</span></span><br><span class="line">    posts := <span class="built_in">make</span>([]*PostVO, <span class="number">0</span>, <span class="built_in">len</span>(allPosts))</span><br><span class="line">    <span class="keyword">for</span> _, post := <span class="keyword">range</span> allPosts &#123;</span><br><span class="line">        postVO := s.buildPostVO(ctx, post)</span><br><span class="line">        postVO.IsLiked = s.checkUserLiked(ctx, post.ID, userID)</span><br><span class="line">        posts = <span class="built_in">append</span>(posts, postVO)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    response := &amp;FeedResponse&#123;</span><br><span class="line">        Posts: posts,</span><br><span class="line">        Pagination: &amp;PaginationVO&#123;</span><br><span class="line">            Page:    page,</span><br><span class="line">            Size:    size,</span><br><span class="line">            Total:   total,</span><br><span class="line">            HasMore: offset+size &lt; <span class="type">int</span>(total),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 缓存结果（缓存5分钟）</span></span><br><span class="line">    s.cacheFeedResult(ctx, cacheKey, response, <span class="number">5</span>*time.Minute)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> response, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-智能点赞系统"><a href="#3-3-3-智能点赞系统" class="headerlink" title="3.3.3 智能点赞系统"></a>3.3.3 智能点赞系统</h4><p>****功能描述****：</p>
<ul>
<li>点赞&#x2F;取消点赞：支持快速响应，防止重复点赞</li>
<li>实时计数：使用Redis实现高性能计数器</li>
<li>点赞列表：支持分页获取点赞用户列表</li>
<li>并发安全：使用分布式锁防止并发问题</li>
</ul>
<p>****技术实现****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">type LikeService struct &#123;</span><br><span class="line">    likeRepo    repository.LikeRepository</span><br><span class="line">    postRepo    repository.PostRepository</span><br><span class="line">    redisClient redis.Client</span><br><span class="line">    lockManager distributed.LockManager</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 点赞/取消点赞 - 支持高并发</span><br><span class="line">func (s *LikeService) ToggleLike(ctx context.Context, postID, userID, enterpriseID int64) (*LikeResult, error) &#123;</span><br><span class="line">    // 1. 分布式锁防止并发点赞</span><br><span class="line">    lockKey := fmt.Sprintf(&quot;like:lock:%d:%d&quot;, postID, userID)</span><br><span class="line">    lock, err := s.lockManager.Acquire(ctx, lockKey, 5*time.Second)</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        return nil, errors.New(&quot;系统繁忙，请稍后重试&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    defer lock.Release()</span><br><span class="line">    </span><br><span class="line">    // 2. 检查当前点赞状态</span><br><span class="line">    shard := s.getShardByEnterpriseID(enterpriseID)</span><br><span class="line">    exists, err := s.likeRepo.CheckExists(ctx, shard, postID, userID)</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        return nil, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var isLiked bool</span><br><span class="line">    var likeCount int64</span><br><span class="line">    </span><br><span class="line">    if exists &#123;</span><br><span class="line">        // 取消点赞</span><br><span class="line">        if err := s.likeRepo.Delete(ctx, shard, postID, userID); err != nil &#123;</span><br><span class="line">            return nil, err</span><br><span class="line">        &#125;</span><br><span class="line">        likeCount = s.decrementLikeCount(ctx, postID)</span><br><span class="line">        isLiked = false</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 添加点赞</span><br><span class="line">        like := &amp;model.Like&#123;</span><br><span class="line">            PostID:       postID,</span><br><span class="line">            UserID:       userID,</span><br><span class="line">            EnterpriseID: enterpriseID,</span><br><span class="line">            CreatedAt:    time.Now(),</span><br><span class="line">        &#125;</span><br><span class="line">        if err := s.likeRepo.Create(ctx, shard, like); err != nil &#123;</span><br><span class="line">            return nil, err</span><br><span class="line">        &#125;</span><br><span class="line">        likeCount = s.incrementLikeCount(ctx, postID)</span><br><span class="line">        isLiked = true</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 3. 异步检查置顶条件</span><br><span class="line">    go s.checkPinnedCondition(postID, enterpriseID, likeCount)</span><br><span class="line">    </span><br><span class="line">    return &amp;LikeResult&#123;</span><br><span class="line">        IsLiked:   isLiked,</span><br><span class="line">        LikeCount: likeCount,</span><br><span class="line">    &#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 高性能点赞计数器</span><br><span class="line">func (s *LikeService) incrementLikeCount(ctx context.Context, postID int64) int64 &#123;</span><br><span class="line">    key := fmt.Sprintf(&quot;post:like_count:%d&quot;, postID)</span><br><span class="line">    count := s.redisClient.Incr(ctx, key).Val()</span><br><span class="line">    </span><br><span class="line">    // 设置过期时间24小时</span><br><span class="line">    s.redisClient.Expire(ctx, key, 24*time.Hour)</span><br><span class="line">    </span><br><span class="line">    return count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-智能置顶算法系统"><a href="#3-3-4-智能置顶算法系统" class="headerlink" title="3.3.4 智能置顶算法系统"></a>3.3.4 智能置顶算法系统</h4><p>****功能描述****：</p>
<ul>
<li>自动检测：24小时内发布且点赞数超过10的内容</li>
<li>智能排序：点赞数前三的内容自动置顶</li>
<li>动态更新：每小时重新计算置顶内容</li>
<li>公平机制：相同点赞数的内容按发布时间排序</li>
</ul>
<p>****核心算法实现****：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PinnedService <span class="keyword">struct</span> &#123;</span><br><span class="line">    postRepo    repository.PostRepository</span><br><span class="line">    redisClient redis.Client</span><br><span class="line">    scheduler   *cron.Cron</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定时任务：更新置顶内容</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PinnedService)</span></span> UpdatePinnedPosts() &#123;</span><br><span class="line">    enterprises, err := s.getAllActiveEnterprises()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Error(<span class="string">&quot;获取企业列表失败&quot;</span>, zap.Error(err))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _, enterpriseID := <span class="keyword">range</span> enterprises &#123;</span><br><span class="line">        <span class="keyword">if</span> err := s.updateEnterpriseTopPosts(enterpriseID); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Error(<span class="string">&quot;更新企业置顶内容失败&quot;</span>, </span><br><span class="line">                zap.Int64(<span class="string">&quot;enterprise_id&quot;</span>, enterpriseID), </span><br><span class="line">                zap.Error(err))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新单个企业的置顶内容</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PinnedService)</span></span> updateEnterpriseTopPosts(enterpriseID <span class="type">int64</span>) <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 获取24小时内的热门内容（点赞数&gt;10）</span></span><br><span class="line">    shard := s.getShardByEnterpriseID(enterpriseID)</span><br><span class="line">    start := time.Now().Add(<span class="number">-24</span> * time.Hour)</span><br><span class="line">    </span><br><span class="line">    hotPosts, err := s.postRepo.GetHotPostsByTimeRange(context.Background(), shard, enterpriseID, start, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 获取实时点赞数（从Redis获取最新数据）</span></span><br><span class="line">    <span class="keyword">for</span> _, post := <span class="keyword">range</span> hotPosts &#123;</span><br><span class="line">        realLikeCount := s.getRealTimeLikeCount(post.ID)</span><br><span class="line">        <span class="keyword">if</span> realLikeCount &gt; <span class="number">0</span> &#123;</span><br><span class="line">            post.LikeCount = <span class="type">int</span>(realLikeCount)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 按点赞数排序（点赞数相同时按创建时间排序）</span></span><br><span class="line">    sort.Slice(hotPosts, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> hotPosts[i].LikeCount == hotPosts[j].LikeCount &#123;</span><br><span class="line">            <span class="keyword">return</span> hotPosts[i].CreatedAt.After(hotPosts[j].CreatedAt)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hotPosts[i].LikeCount &gt; hotPosts[j].LikeCount</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 清空旧的置顶状态</span></span><br><span class="line">    <span class="keyword">if</span> err := s.postRepo.ClearPinnedStatus(context.Background(), shard, enterpriseID); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 设置新的置顶内容（前3名）</span></span><br><span class="line">    topCount := <span class="built_in">len</span>(hotPosts)</span><br><span class="line">    <span class="keyword">if</span> topCount &gt; <span class="number">3</span> &#123;</span><br><span class="line">        topCount = <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; topCount; i++ &#123;</span><br><span class="line">        post := hotPosts[i]</span><br><span class="line">        err := s.postRepo.SetPinnedStatus(context.Background(), shard, post.ID, i+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Error(<span class="string">&quot;设置置顶状态失败&quot;</span>, zap.Int64(<span class="string">&quot;post_id&quot;</span>, post.ID), zap.Error(err))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 更新缓存</span></span><br><span class="line">    s.updatePinnedCache(enterpriseID, hotPosts[:topCount])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实时检查置顶条件（点赞触发）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PinnedService)</span></span> CheckPinnedCondition(postID, enterpriseID <span class="type">int64</span>, likeCount <span class="type">int64</span>) &#123;</span><br><span class="line">    <span class="comment">// 只有点赞数达到10时才触发检查</span></span><br><span class="line">    <span class="keyword">if</span> likeCount == <span class="number">10</span> &#123;</span><br><span class="line">        <span class="comment">// 检查是否为24小时内发布</span></span><br><span class="line">        shard := s.getShardByEnterpriseID(enterpriseID)</span><br><span class="line">        post, err := s.postRepo.GetByID(context.Background(), shard, postID)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> time.Since(post.CreatedAt) &lt;= <span class="number">24</span>*time.Hour &#123;</span><br><span class="line">            <span class="comment">// 异步触发置顶更新</span></span><br><span class="line">            <span class="keyword">go</span> s.updateEnterpriseTopPosts(enterpriseID)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-5-评论系统"><a href="#3-3-5-评论系统" class="headerlink" title="3.3.5 评论系统"></a>3.3.5 评论系统</h4><p>****功能描述****：</p>
<ul>
<li>顶级评论：直接对内容进行评论</li>
<li>回复评论：支持二级回复（回复具体的评论）</li>
<li>评论删除：评论者和内容发布者均可删除</li>
<li>评论点赞：支持对评论进行点赞</li>
</ul>
<p>****技术实现****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">type CommentService struct &#123;</span><br><span class="line">    commentRepo repository.CommentRepository</span><br><span class="line">    postRepo    repository.PostRepository</span><br><span class="line">    redisClient redis.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 发表评论</span><br><span class="line">func (s *CommentService) CreateComment(ctx context.Context, req *CreateCommentRequest) (*CommentVO, error) &#123;</span><br><span class="line">    // 1. 验证目标内容是否存在</span><br><span class="line">    shard := s.getShardByEnterpriseID(req.EnterpriseID)</span><br><span class="line">    post, err := s.postRepo.GetByID(ctx, shard, req.PostID)</span><br><span class="line">    if err != nil || post.Status != 1 &#123;</span><br><span class="line">        return nil, errors.New(&quot;目标内容不存在或已删除&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 2. 如果是回复评论，验证父评论</span><br><span class="line">    var rootID int64 = 0</span><br><span class="line">    if req.ParentID &gt; 0 &#123;</span><br><span class="line">        parentComment, err := s.commentRepo.GetByID(ctx, shard, req.ParentID)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">            return nil, errors.New(&quot;父评论不存在&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        // 确定根评论ID</span><br><span class="line">        if parentComment.RootID &gt; 0 &#123;</span><br><span class="line">            rootID = parentComment.RootID</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            rootID = parentComment.ID</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 3. 创建评论</span><br><span class="line">    comment := &amp;model.Comment&#123;</span><br><span class="line">        PostID:         req.PostID,</span><br><span class="line">        UserID:         req.UserID,</span><br><span class="line">        EnterpriseID:   req.EnterpriseID,</span><br><span class="line">        ParentID:       req.ParentID,</span><br><span class="line">        RootID:         rootID,</span><br><span class="line">        ReplyToUserID:  req.ReplyToUserID,</span><br><span class="line">        Content:        req.Content,</span><br><span class="line">        Status:         1,</span><br><span class="line">        CreatedAt:      time.Now(),</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if err := s.commentRepo.Create(ctx, shard, comment); err != nil &#123;</span><br><span class="line">        return nil, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 4. 更新内容的评论数</span><br><span class="line">    s.postRepo.IncrementCommentCount(ctx, shard, req.PostID)</span><br><span class="line">    </span><br><span class="line">    // 5. 如果是回复，更新父评论的回复数</span><br><span class="line">    if req.ParentID &gt; 0 &#123;</span><br><span class="line">        s.commentRepo.IncrementReplyCount(ctx, shard, req.ParentID)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return s.buildCommentVO(ctx, comment), nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-6-缓存策略设计"><a href="#3-3-6-缓存策略设计" class="headerlink" title="3.3.6 缓存策略设计"></a>3.3.6 缓存策略设计</h4><p>****Redis数据结构设计****：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 点赞计数器</span><br><span class="line">Key: <span class="string">&quot;post:like_count:&#123;post_id&#125;&quot;</span></span><br><span class="line">Type: String</span><br><span class="line">TTL: 24小时</span><br><span class="line">Value: 点赞数量</span><br><span class="line"></span><br><span class="line">// 用户会话缓存</span><br><span class="line">Key: <span class="string">&quot;user:session:&#123;user_id&#125;&quot;</span></span><br><span class="line">Type: Hash</span><br><span class="line">TTL: 7天</span><br><span class="line">Fields: &#123;<span class="string">&quot;id&quot;</span>, <span class="string">&quot;enterprise_id&quot;</span>, <span class="string">&quot;nickname&quot;</span>, <span class="string">&quot;avatar&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">// 企业Feed缓存</span><br><span class="line">Key: <span class="string">&quot;feed:&#123;enterprise_id&#125;:&#123;page&#125;:&#123;size&#125;&quot;</span></span><br><span class="line">Type: String (JSON)</span><br><span class="line">TTL: 5分钟</span><br><span class="line">Value: 序列化的动态列表</span><br><span class="line"></span><br><span class="line">// 置顶内容缓存</span><br><span class="line">Key: <span class="string">&quot;pinned:posts:&#123;enterprise_id&#125;&quot;</span></span><br><span class="line">Type: List</span><br><span class="line">TTL: 1小时</span><br><span class="line">Value: 置顶内容ID列表（按排序）</span><br><span class="line"></span><br><span class="line">// 热门内容24小时榜单</span><br><span class="line">Key: <span class="string">&quot;hot:posts:24h:&#123;enterprise_id&#125;&quot;</span></span><br><span class="line">Type: Sorted Set</span><br><span class="line">TTL: 1小时</span><br><span class="line">Score: 点赞数，Member: post_id</span><br></pre></td></tr></table></figure>

<h3 id="3-4-接口设计"><a href="#3-4-接口设计" class="headerlink" title="3.4 接口设计"></a>3.4 接口设计</h3><h4 id="3-4-1-用户认证接口"><a href="#3-4-1-用户认证接口" class="headerlink" title="3.4.1 用户认证接口"></a>3.4.1 用户认证接口</h4><h5 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/auth/register</span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span>           <span class="comment">// 必填，用户名，3-20字符</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;password123&quot;</span><span class="punctuation">,</span>        <span class="comment">// 必填，密码，8-32字符</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan@company.com&quot;</span><span class="punctuation">,</span>  <span class="comment">// 必填，邮箱地址</span></span><br><span class="line">    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span>               <span class="comment">// 必填，昵称，1-20字符</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13800138000&quot;</span><span class="punctuation">,</span>           <span class="comment">// 可选，手机号</span></span><br><span class="line">    <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;技术部&quot;</span><span class="punctuation">,</span>           <span class="comment">// 可选，部门</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高级工程师&quot;</span><span class="punctuation">,</span>         <span class="comment">// 可选，职位</span></span><br><span class="line">    <span class="attr">&quot;enterprise_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TECH001&quot;</span>      <span class="comment">// 必填，企业邀请码</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;注册成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;enterprise_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;科技有限公司&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/auth/login</span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span>     <span class="comment">// 用户名或邮箱</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;password123&quot;</span>   <span class="comment">// 密码</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;登录成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;expires_in&quot;</span><span class="punctuation">:</span> <span class="number">7200</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;技术部&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高级工程师&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;enterprise&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;科技有限公司&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/logos/100.jpg&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="刷新令牌"><a href="#刷新令牌" class="headerlink" title="刷新令牌"></a>刷新令牌</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/auth/refresh</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<h5 id="用户登出"><a href="#用户登出" class="headerlink" title="用户登出"></a>用户登出</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/auth/logout</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-企业圈内容接口"><a href="#3-4-2-企业圈内容接口" class="headerlink" title="3.4.2 企业圈内容接口"></a>3.4.2 企业圈内容接口</h4><h5 id="发布内容"><a href="#发布内容" class="headerlink" title="发布内容"></a>发布内容</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/posts</span><br><span class="line">Authorization<span class="punctuation">:</span> Bearer <span class="punctuation">&#123;</span>token<span class="punctuation">&#125;</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;今天的工作总结，团队协作很棒！&quot;</span><span class="punctuation">,</span>     <span class="comment">// 必填，内容文本，1-2000字符</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>                                      <span class="comment">// 可选，图片URL数组，最多9张</span></span><br><span class="line">        <span class="string">&quot;https://cdn.example.com/images/001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://cdn.example.com/images/002.jpg&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;video_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/video.mp4&quot;</span><span class="punctuation">,</span> <span class="comment">// 可选，视频URL</span></span><br><span class="line">    <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京市朝阳区望京SOHO&quot;</span><span class="punctuation">,</span>                <span class="comment">// 可选，位置信息</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;工作总结&quot;</span><span class="punctuation">,</span> <span class="string">&quot;团队协作&quot;</span><span class="punctuation">]</span>                   <span class="comment">// 可选，标签数组</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;发布成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123456</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;今天的工作总结，团队协作很棒！&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;https://cdn.example.com/images/001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;https://cdn.example.com/images/002.jpg&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;video_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/video.mp4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京市朝阳区望京SOHO&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;工作总结&quot;</span><span class="punctuation">,</span> <span class="string">&quot;团队协作&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;view_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;is_pinned&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T10:00:00Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="获取企业圈动态"><a href="#获取企业圈动态" class="headerlink" title="获取企业圈动态"></a>获取企业圈动态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/posts?page=1&amp;size=20&amp;sort=created_at</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****查询参数****：</p>
<ul>
<li><code>page</code>: 页码，默认1</li>
<li><code>size</code>: 每页数量，默认20，最大100</li>
<li><code>sort</code>: 排序方式，可选值：created_at（时间）、like_count（点赞数）</li>
</ul>
<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;posts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123456</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;技术部&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高级工程师&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;今天的工作总结，团队协作很棒！&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;https://cdn.example.com/images/001.jpg&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;video_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京市朝阳区望京SOHO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;工作总结&quot;</span><span class="punctuation">,</span> <span class="string">&quot;团队协作&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;comment_count&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;view_count&quot;</span><span class="punctuation">:</span> <span class="number">156</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;share_count&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_liked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_pinned&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;pinned_order&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;can_edit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;can_delete&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T08:30:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;updated_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T08:30:00Z&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pagination&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">156</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;has_more&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="获取单个内容详情"><a href="#获取单个内容详情" class="headerlink" title="获取单个内容详情"></a>获取单个内容详情</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/posts/&#123;post_id&#125;</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<h5 id="编辑内容"><a href="#编辑内容" class="headerlink" title="编辑内容"></a>编辑内容</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /api/v1/posts/<span class="punctuation">&#123;</span>post_id<span class="punctuation">&#125;</span></span><br><span class="line">Authorization<span class="punctuation">:</span> Bearer <span class="punctuation">&#123;</span>token<span class="punctuation">&#125;</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;修改后的内容&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://cdn.example.com/images/new.jpg&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;新标签&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>****业务规则****：</p>
<ul>
<li>只能编辑自己发布的内容</li>
<li>发布后24小时内可编辑</li>
<li>编辑后重置点赞和评论计数</li>
</ul>
<h5 id="删除内容"><a href="#删除内容" class="headerlink" title="删除内容"></a>删除内容</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE /api/v1/posts/&#123;post_id&#125;</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;删除成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-3-点赞相关接口"><a href="#3-4-3-点赞相关接口" class="headerlink" title="3.4.3 点赞相关接口"></a>3.4.3 点赞相关接口</h4><h5 id="点赞-取消点赞"><a href="#点赞-取消点赞" class="headerlink" title="点赞&#x2F;取消点赞"></a>点赞&#x2F;取消点赞</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/posts/&#123;post_id&#125;/like</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****路径参数****：</p>
<ul>
<li><code>post_id</code>: 内容ID，必填</li>
</ul>
<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;is_liked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>          <span class="comment">// 当前点赞状态</span></span><br><span class="line">        <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span>          <span class="comment">// 最新点赞总数</span></span><br><span class="line">        <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;liked&quot;</span>          <span class="comment">// 操作类型：liked/unliked</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="获取点赞列表"><a href="#获取点赞列表" class="headerlink" title="获取点赞列表"></a>获取点赞列表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/posts/&#123;post_id&#125;/likes?page=1&amp;size=20</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****查询参数****：</p>
<ul>
<li><code>page</code>: 页码，默认1</li>
<li><code>size</code>: 每页数量，默认20，最大50</li>
</ul>
<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;技术部&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高级工程师&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;liked_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T10:30:00Z&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1002</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;李四&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1002.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;产品部&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;产品经理&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;liked_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T09:15:00Z&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pagination&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;has_more&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="批量检查点赞状态"><a href="#批量检查点赞状态" class="headerlink" title="批量检查点赞状态"></a>批量检查点赞状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/posts/likes/batch-check</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;post_ids&quot;: [123456, 123457, 123458]  // 内容ID数组，最多100个</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;like_status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;123456&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;123457&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;123458&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-4-评论相关接口"><a href="#3-4-4-评论相关接口" class="headerlink" title="3.4.4 评论相关接口"></a>3.4.4 评论相关接口</h4><h5 id="发表评论"><a href="#发表评论" class="headerlink" title="发表评论"></a>发表评论</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/posts/<span class="punctuation">&#123;</span>post_id<span class="punctuation">&#125;</span>/comments</span><br><span class="line">Authorization<span class="punctuation">:</span> Bearer <span class="punctuation">&#123;</span>token<span class="punctuation">&#125;</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;非常赞同你的观点！&quot;</span><span class="punctuation">,</span>        <span class="comment">// 必填，评论内容，1-500字符</span></span><br><span class="line">    <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>                       <span class="comment">// 可选，父评论ID，0为顶级评论</span></span><br><span class="line">    <span class="attr">&quot;reply_to_user_id&quot;</span><span class="punctuation">:</span> <span class="number">1002</span>             <span class="comment">// 可选，回复的用户ID</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;评论成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">789012</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;非常赞同你的观点！&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;root_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reply_to_user_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;技术部&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reply_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;can_delete&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T11:15:00Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="获取评论列表"><a href="#获取评论列表" class="headerlink" title="获取评论列表"></a>获取评论列表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/posts/&#123;post_id&#125;/comments?page=1&amp;size=20&amp;sort=created_at</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****查询参数****：</p>
<ul>
<li><code>page</code>: 页码，默认1</li>
<li><code>size</code>: 每页数量，默认20，最大100</li>
<li><code>sort</code>: 排序方式，可选值：created_at（时间）、like_count（点赞数）</li>
</ul>
<p>****响应示例****：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;comments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">789012</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;非常赞同你的观点！&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;root_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1001.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;技术部&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;reply_to_user&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;reply_count&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_liked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;can_delete&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;replies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">789013</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我也这么认为&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="number">789012</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;root_id&quot;</span><span class="punctuation">:</span> <span class="number">789012</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1002</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;李四&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.example.com/avatars/1002.jpg&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;reply_to_user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T11:20:00Z&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-12-19T11:15:00Z&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pagination&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;has_more&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="回复评论"><a href="#回复评论" class="headerlink" title="回复评论"></a>回复评论</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/comments/&#123;comment_id&#125;/replies</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;content&quot;: &quot;我也这么认为&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="评论点赞"><a href="#评论点赞" class="headerlink" title="评论点赞"></a>评论点赞</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/comments/&#123;comment_id&#125;/like</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<h5 id="删除评论"><a href="#删除评论" class="headerlink" title="删除评论"></a>删除评论</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE /api/v1/comments/&#123;comment_id&#125;</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 200,</span><br><span class="line">    &quot;message&quot;: &quot;删除成功&quot;,</span><br><span class="line">    &quot;data&quot;: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-5-文件上传接口"><a href="#3-4-5-文件上传接口" class="headerlink" title="3.4.5 文件上传接口"></a>3.4.5 文件上传接口</h4><h5 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/upload/images</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br><span class="line">Content-Type: multipart/form-data</span><br><span class="line"></span><br><span class="line">files: [File, File, ...]  // 支持批量上传，最多9张图片</span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 200,</span><br><span class="line">    &quot;message&quot;: &quot;上传成功&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;urls&quot;: [</span><br><span class="line">            &quot;https://cdn.example.com/images/20241219/001.jpg&quot;,</span><br><span class="line">            &quot;https://cdn.example.com/images/20241219/002.jpg&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="视频上传"><a href="#视频上传" class="headerlink" title="视频上传"></a>视频上传</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/upload/video</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br><span class="line">Content-Type: multipart/form-data</span><br><span class="line"></span><br><span class="line">file: File  // 单个视频文件，最大100MB</span><br></pre></td></tr></table></figure>

<h4 id="3-4-6-统计接口"><a href="#3-4-6-统计接口" class="headerlink" title="3.4.6 统计接口"></a>3.4.6 统计接口</h4><h5 id="获取企业圈统计数据"><a href="#获取企业圈统计数据" class="headerlink" title="获取企业圈统计数据"></a>获取企业圈统计数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/statistics/enterprise</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<p>****响应示例****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 200,</span><br><span class="line">    &quot;message&quot;: &quot;获取成功&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;total_posts&quot;: 1250,           // 企业总内容数</span><br><span class="line">        &quot;total_users&quot;: 89,             // 企业总用户数</span><br><span class="line">        &quot;today_posts&quot;: 15,             // 今日新增内容</span><br><span class="line">        &quot;today_active_users&quot;: 67,      // 今日活跃用户</span><br><span class="line">        &quot;hot_posts&quot;: [                 // 当前热门内容(前3)</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: 123456,</span><br><span class="line">                &quot;content&quot;: &quot;工作总结摘要...&quot;,</span><br><span class="line">                &quot;like_count&quot;: 35,</span><br><span class="line">                &quot;is_pinned&quot;: true</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获取个人统计数据"><a href="#获取个人统计数据" class="headerlink" title="获取个人统计数据"></a>获取个人统计数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/statistics/personal</span><br><span class="line">Authorization: Bearer &#123;token&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-7-通用响应格式"><a href="#3-4-7-通用响应格式" class="headerlink" title="3.4.7 通用响应格式"></a>3.4.7 通用响应格式</h4><p>所有API接口均采用统一的响应格式：</p>
<p>****成功响应****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 200,</span><br><span class="line">    &quot;message&quot;: &quot;success&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        // 具体数据内容</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>****错误响应****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 400,  // 错误码</span><br><span class="line">    &quot;message&quot;: &quot;参数错误&quot;,  // 错误信息</span><br><span class="line">    &quot;data&quot;: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>****常见错误码****：</p>
<ul>
<li>200: 请求成功</li>
<li>400: 请求参数错误</li>
<li>401: 未授权（token无效或过期）</li>
<li>403: 无权限访问（跨企业访问等）</li>
<li>404: 资源不存在</li>
<li>409: 资源冲突（重复点赞等）</li>
<li>422: 业务逻辑错误（超出编辑时限等）</li>
<li>429: 请求频率限制</li>
<li>500: 服务器内部错误</li>
<li>503: 服务暂不可用</li>
</ul>
<p>****错误响应详细示例****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 422,</span><br><span class="line">    &quot;message&quot;: &quot;内容发布失败&quot;,</span><br><span class="line">    &quot;data&quot;: null,</span><br><span class="line">    &quot;error_details&quot;: &#123;</span><br><span class="line">        &quot;error_code&quot;: &quot;POST_EDIT_TIMEOUT&quot;,</span><br><span class="line">        &quot;error_msg&quot;: &quot;发布时间超过24小时，无法编辑&quot;,</span><br><span class="line">        &quot;field&quot;: &quot;created_at&quot;,</span><br><span class="line">        &quot;timestamp&quot;: &quot;2024-12-19T10:00:00Z&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-部署架构设计"><a href="#3-5-部署架构设计" class="headerlink" title="3.5 部署架构设计"></a>3.5 部署架构设计</h3><h4 id="3-5-1-容器化部署"><a href="#3-5-1-容器化部署" class="headerlink" title="3.5.1 容器化部署"></a>3.5.1 容器化部署</h4><p>****Docker镜像构建****：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.21</span>-alpine AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go mod download</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> CGO_ENABLED=0 GOOS=linux go build -o enterprise-circle ./cmd/server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk --no-cache add ca-certificates tzdata</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/enterprise-circle .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/configs ./configs</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;./enterprise-circle&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>****Kubernetes部署配置****：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">enterprise-circle-api</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">enterprise-circle-api</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">enterprise-circle-api</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">api</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">enterprise-circle:v1.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;mysql-cluster&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">REDIS_HOST</span>  </span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;redis-cluster&quot;</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-5-2-监控部署"><a href="#3-5-2-监控部署" class="headerlink" title="3.5.2 监控部署"></a>3.5.2 监控部署</h4><p>****Prometheus监控配置****：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># prometheus.yml</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;enterprise-circle&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;api:8080&#x27;</span>]</span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/metrics&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">10s</span></span><br></pre></td></tr></table></figure>

<h2 id="四、技术实现要点"><a href="#四、技术实现要点" class="headerlink" title="四、技术实现要点"></a>四、技术实现要点</h2><h3 id="4-1-高并发优化策略"><a href="#4-1-高并发优化策略" class="headerlink" title="4.1 高并发优化策略"></a>4.1 高并发优化策略</h3><h4 id="4-1-1-分层缓存体系"><a href="#4-1-1-分层缓存体系" class="headerlink" title="4.1.1 分层缓存体系"></a>4.1.1 分层缓存体系</h4><p>****L1缓存 - 本地缓存****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 使用sync.Map实现高性能本地缓存</span><br><span class="line">type LocalCache struct &#123;</span><br><span class="line">    enterpriseCache sync.Map  // 企业信息缓存</span><br><span class="line">    userCache      sync.Map   // 用户基础信息缓存</span><br><span class="line">    configCache    sync.Map   // 配置信息缓存</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 企业信息本地缓存（变化频率低）</span><br><span class="line">func (c *LocalCache) GetEnterprise(enterpriseID int64) *model.Enterprise &#123;</span><br><span class="line">    if val, ok := c.enterpriseCache.Load(enterpriseID); ok &#123;</span><br><span class="line">        return val.(*model.Enterprise)</span><br><span class="line">    &#125;</span><br><span class="line">    return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>****L2缓存 - Redis分布式缓存****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// Redis缓存策略配置</span><br><span class="line">var CacheConfig = map[string]CacheStrategy&#123;</span><br><span class="line">    &quot;user:session&quot;:    &#123;TTL: 7 * 24 * time.Hour, Type: &quot;hash&quot;&#125;,</span><br><span class="line">    &quot;post:detail&quot;:     &#123;TTL: 1 * time.Hour, Type: &quot;string&quot;&#125;,</span><br><span class="line">    &quot;post:like_count&quot;: &#123;TTL: 24 * time.Hour, Type: &quot;string&quot;&#125;,</span><br><span class="line">    &quot;feed:enterprise&quot;: &#123;TTL: 5 * time.Minute, Type: &quot;string&quot;&#125;,</span><br><span class="line">    &quot;hot:posts:24h&quot;:   &#123;TTL: 1 * time.Hour, Type: &quot;zset&quot;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-数据库集群架构"><a href="#4-1-2-数据库集群架构" class="headerlink" title="4.1.2 数据库集群架构"></a>4.1.2 数据库集群架构</h4><p>****MySQL读写分离配置****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 数据库配置</span><br><span class="line">database:</span><br><span class="line">  master:</span><br><span class="line">    host: mysql-master.example.com</span><br><span class="line">    port: 3306</span><br><span class="line">    max_open_conns: 200</span><br><span class="line">    max_idle_conns: 50</span><br><span class="line">  </span><br><span class="line">  slaves:</span><br><span class="line">    - host: mysql-slave1.example.com</span><br><span class="line">      port: 3306</span><br><span class="line">      weight: 1</span><br><span class="line">    - host: mysql-slave2.example.com  </span><br><span class="line">      port: 3306</span><br><span class="line">      weight: 1</span><br><span class="line">  </span><br><span class="line">  sharding:</span><br><span class="line">    strategy: &quot;enterprise_id&quot;</span><br><span class="line">    shard_count: 100</span><br><span class="line">    rule: &quot;enterprise_id % 100&quot;</span><br></pre></td></tr></table></figure>

<p>****分表路由策略****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">type ShardingRouter struct &#123;</span><br><span class="line">    shardCount int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (r *ShardingRouter) GetShard(enterpriseID int64) string &#123;</span><br><span class="line">    shard := enterpriseID % int64(r.shardCount)</span><br><span class="line">    return fmt.Sprintf(&quot;%d&quot;, shard)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (r *ShardingRouter) GetTableName(baseTable string, enterpriseID int64) string &#123;</span><br><span class="line">    shard := r.GetShard(enterpriseID)</span><br><span class="line">    return fmt.Sprintf(&quot;%s_%s&quot;, baseTable, shard)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-异步处理架构"><a href="#4-1-3-异步处理架构" class="headerlink" title="4.1.3 异步处理架构"></a>4.1.3 异步处理架构</h4><p>****消息队列设计****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// 消息队列主题设计</span><br><span class="line">const (</span><br><span class="line">    TopicFeedUpdate    = &quot;feed.update&quot;     // Feed更新</span><br><span class="line">    TopicLikeEvent     = &quot;like.event&quot;      // 点赞事件</span><br><span class="line">    TopicCommentEvent  = &quot;comment.event&quot;   // 评论事件</span><br><span class="line">    TopicPinnedUpdate  = &quot;pinned.update&quot;   // 置顶更新</span><br><span class="line">    TopicStatistics    = &quot;statistics&quot;      // 统计数据</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 异步消息处理器</span><br><span class="line">type AsyncProcessor struct &#123;</span><br><span class="line">    contentService *ContentService</span><br><span class="line">    likeService    *LikeService</span><br><span class="line">    redisClient    redis.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理Feed更新消息</span><br><span class="line">func (p *AsyncProcessor) HandleFeedUpdate(msg *FeedUpdateMessage) error &#123;</span><br><span class="line">    switch msg.Action &#123;</span><br><span class="line">    case &quot;create&quot;:</span><br><span class="line">        return p.contentService.InvalidateFeedCache(msg.EnterpriseID)</span><br><span class="line">    case &quot;delete&quot;:</span><br><span class="line">        return p.contentService.RemoveFromFeedCache(msg.PostID, msg.EnterpriseID)</span><br><span class="line">    case &quot;update&quot;:</span><br><span class="line">        return p.contentService.UpdateFeedCache(msg.PostID, msg.EnterpriseID)</span><br><span class="line">    &#125;</span><br><span class="line">    return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-4-连接池优化"><a href="#4-1-4-连接池优化" class="headerlink" title="4.1.4 连接池优化"></a>4.1.4 连接池优化</h4><p>****数据库连接池配置****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// MySQL连接池优化配置</span><br><span class="line">func NewMySQLConfig() *mysql.Config &#123;</span><br><span class="line">    return &amp;mysql.Config&#123;</span><br><span class="line">        MaxOpenConns:    200,              // 最大连接数</span><br><span class="line">        MaxIdleConns:    50,               // 最大空闲连接数</span><br><span class="line">        ConnMaxLifetime: 60 * time.Minute, // 连接最大生存时间</span><br><span class="line">        ConnMaxIdleTime: 10 * time.Minute, // 连接最大空闲时间</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Redis连接池配置</span><br><span class="line">func NewRedisConfig() *redis.Options &#123;</span><br><span class="line">    return &amp;redis.Options&#123;</span><br><span class="line">        PoolSize:     100,              // 连接池大小</span><br><span class="line">        MinIdleConns: 20,               // 最小空闲连接数</span><br><span class="line">        MaxRetries:   3,                // 最大重试次数</span><br><span class="line">        PoolTimeout:  5 * time.Second,  // 获取连接超时</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-数据一致性保障"><a href="#4-2-数据一致性保障" class="headerlink" title="4.2 数据一致性保障"></a>4.2 数据一致性保障</h3><h4 id="4-2-1-分布式锁实现"><a href="#4-2-1-分布式锁实现" class="headerlink" title="4.2.1 分布式锁实现"></a>4.2.1 分布式锁实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">type DistributedLock struct &#123;</span><br><span class="line">    redisClient redis.Client</span><br><span class="line">    keyPrefix   string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取分布式锁</span><br><span class="line">func (l *DistributedLock) Acquire(ctx context.Context, key string, expiry time.Duration) (*Lock, error) &#123;</span><br><span class="line">    lockKey := l.keyPrefix + key</span><br><span class="line">    lockValue := uuid.New().String()</span><br><span class="line">    </span><br><span class="line">    // 使用SET NX EX原子操作获取锁</span><br><span class="line">    success := l.redisClient.SetNX(ctx, lockKey, lockValue, expiry).Val()</span><br><span class="line">    if !success &#123;</span><br><span class="line">        return nil, errors.New(&quot;获取锁失败&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return &amp;Lock&#123;</span><br><span class="line">        key:   lockKey,</span><br><span class="line">        value: lockValue,</span><br><span class="line">        redis: l.redisClient,</span><br><span class="line">    &#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 释放锁（使用Lua脚本保证原子性）</span><br><span class="line">func (lock *Lock) Release() error &#123;</span><br><span class="line">    script := `</span><br><span class="line">        if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then</span><br><span class="line">            return redis.call(&quot;del&quot;, KEYS[1])</span><br><span class="line">        else</span><br><span class="line">            return 0</span><br><span class="line">        end</span><br><span class="line">    `</span><br><span class="line">    return lock.redis.Eval(context.Background(), script, []string&#123;lock.key&#125;, lock.value).Err()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-最终一致性方案"><a href="#4-2-2-最终一致性方案" class="headerlink" title="4.2.2 最终一致性方案"></a>4.2.2 最终一致性方案</h4><p>****数据同步策略****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 定期同步Redis计数器到MySQL</span><br><span class="line">func (s *SyncService) SyncLikeCountsToMySQL() &#123;</span><br><span class="line">    // 1. 获取所有待同步的计数器</span><br><span class="line">    pattern := &quot;post:like_count:*&quot;</span><br><span class="line">    keys := s.redisClient.Keys(context.Background(), pattern).Val()</span><br><span class="line">    </span><br><span class="line">    // 2. 批量获取计数值</span><br><span class="line">    pipe := s.redisClient.Pipeline()</span><br><span class="line">    for _, key := range keys &#123;</span><br><span class="line">        pipe.Get(context.Background(), key)</span><br><span class="line">    &#125;</span><br><span class="line">    results, err := pipe.Exec(context.Background())</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 3. 批量更新数据库</span><br><span class="line">    updates := make(map[int64]int64)</span><br><span class="line">    for i, result := range results &#123;</span><br><span class="line">        postID := s.extractPostIDFromKey(keys[i])</span><br><span class="line">        count := result.(*redis.StringCmd).Val()</span><br><span class="line">        if countInt, err := strconv.ParseInt(count, 10, 64); err == nil &#123;</span><br><span class="line">            updates[postID] = countInt</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 4. 事务更新MySQL</span><br><span class="line">    s.postRepo.BatchUpdateLikeCount(context.Background(), updates)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-性能监控与告警"><a href="#4-3-性能监控与告警" class="headerlink" title="4.3 性能监控与告警"></a>4.3 性能监控与告警</h3><h4 id="4-3-1-关键指标监控"><a href="#4-3-1-关键指标监控" class="headerlink" title="4.3.1 关键指标监控"></a>4.3.1 关键指标监控</h4><p>****API性能指标****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">type Metrics struct &#123;</span><br><span class="line">    // API响应时间分布</span><br><span class="line">    APILatency       *prometheus.HistogramVec</span><br><span class="line">    // API请求频率</span><br><span class="line">    APIRequestTotal  *prometheus.CounterVec</span><br><span class="line">    // API错误率</span><br><span class="line">    APIErrorRate     *prometheus.CounterVec</span><br><span class="line">    // 数据库连接池使用率</span><br><span class="line">    DBPoolUsage      prometheus.Gauge</span><br><span class="line">    // Redis连接池使用率</span><br><span class="line">    RedisPoolUsage   prometheus.Gauge</span><br><span class="line">    // 置顶算法执行时间</span><br><span class="line">    PinnedAlgorithmDuration prometheus.Histogram</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 监控中间件</span><br><span class="line">func MetricsMiddleware(metrics *Metrics) gin.HandlerFunc &#123;</span><br><span class="line">    return func(c *gin.Context) &#123;</span><br><span class="line">        start := time.Now()</span><br><span class="line">        path := c.FullPath()</span><br><span class="line">        method := c.Request.Method</span><br><span class="line">        </span><br><span class="line">        c.Next()</span><br><span class="line">        </span><br><span class="line">        duration := time.Since(start)</span><br><span class="line">        status := c.Writer.Status()</span><br><span class="line">        </span><br><span class="line">        // 记录响应时间</span><br><span class="line">        metrics.APILatency.WithLabelValues(method, path).Observe(duration.Seconds())</span><br><span class="line">        </span><br><span class="line">        // 记录请求计数</span><br><span class="line">        metrics.APIRequestTotal.WithLabelValues(method, path, strconv.Itoa(status)).Inc()</span><br><span class="line">        </span><br><span class="line">        // 记录错误率</span><br><span class="line">        if status &gt;= 400 &#123;</span><br><span class="line">            metrics.APIErrorRate.WithLabelValues(method, path).Inc()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-2-业务监控指标"><a href="#4-3-2-业务监控指标" class="headerlink" title="4.3.2 业务监控指标"></a>4.3.2 业务监控指标</h4><p>****关键业务指标****：</p>
<ul>
<li>****内容发布量****：每分钟、每小时、每日发布量统计</li>
<li>****用户活跃度****：DAU、MAU统计</li>
<li>****点赞互动率****：平均点赞数、点赞参与度</li>
<li>****置顶命中率****：24小时内达到置顶条件的内容比例</li>
<li>****系统稳定性****：API可用率、平均响应时间</li>
</ul>
<p>****告警规则配置****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">alerts:</span><br><span class="line">  - name: &quot;API响应时间过长&quot;</span><br><span class="line">    condition: &quot;api_latency_p99 &gt; 1000ms&quot;</span><br><span class="line">    severity: &quot;warning&quot;</span><br><span class="line">  </span><br><span class="line">  - name: &quot;数据库连接池使用率过高&quot;</span><br><span class="line">    condition: &quot;db_pool_usage &gt; 0.8&quot;</span><br><span class="line">    severity: &quot;critical&quot;</span><br><span class="line">  </span><br><span class="line">  - name: &quot;Redis连接池使用率过高&quot;</span><br><span class="line">    condition: &quot;redis_pool_usage &gt; 0.9&quot;</span><br><span class="line">    severity: &quot;warning&quot;</span><br><span class="line">  </span><br><span class="line">  - name: &quot;错误率过高&quot;</span><br><span class="line">    condition: &quot;api_error_rate &gt; 0.01&quot;</span><br><span class="line">    severity: &quot;critical&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-安全性设计"><a href="#4-4-安全性设计" class="headerlink" title="4.4 安全性设计"></a>4.4 安全性设计</h3><h4 id="4-4-1-认证安全"><a href="#4-4-1-认证安全" class="headerlink" title="4.4.1 认证安全"></a>4.4.1 认证安全</h4><p>****JWT令牌安全策略****：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">type JWTConfig struct &#123;</span><br><span class="line">    SecretKey       string        // 密钥，定期轮换</span><br><span class="line">    AccessTokenTTL  time.Duration // 访问令牌有效期：2小时</span><br><span class="line">    RefreshTokenTTL time.Duration // 刷新令牌有效期：7天</span><br><span class="line">    Issuer          string        // 签发者</span><br><span class="line">    Algorithm       string        // 签名算法：HS256</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 令牌黑名单机制</span><br><span class="line">func (s *AuthService) AddToBlacklist(ctx context.Context, tokenID string) error &#123;</span><br><span class="line">    key := fmt.Sprintf(&quot;blacklist:token:%s&quot;, tokenID)</span><br><span class="line">    return s.redisClient.Set(ctx, key, &quot;1&quot;, 7*24*time.Hour).Err()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-2-数据安全"><a href="#4-4-2-数据安全" class="headerlink" title="4.4.2 数据安全"></a>4.4.2 数据安全</h4><p>****敏感数据处理****：</p>
<ul>
<li>密码使用bcrypt加密存储</li>
<li>用户数据按企业ID严格隔离</li>
<li>API接口添加频率限制</li>
<li>关键操作记录审计日志</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 频率限制中间件</span><br><span class="line">func RateLimitMiddleware() gin.HandlerFunc &#123;</span><br><span class="line">    limiter := rate.NewLimiter(rate.Every(time.Second), 100) // 每秒100次</span><br><span class="line">    </span><br><span class="line">    return func(c *gin.Context) &#123;</span><br><span class="line">        if !limiter.Allow() &#123;</span><br><span class="line">            c.JSON(429, gin.H&#123;&quot;error&quot;: &quot;请求频率过高，请稍后重试&quot;&#125;)</span><br><span class="line">            c.Abort()</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        c.Next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、附录"><a href="#五、附录" class="headerlink" title="五、附录"></a>五、附录</h2><h3 id="5-1-名词解释"><a href="#5-1-名词解释" class="headerlink" title="5.1 名词解释"></a>5.1 名词解释</h3><table>
<thead>
<tr>
<th><em><strong>*术语*</strong></em></th>
<th><em><strong>*解释*</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td>企业圈</td>
<td>类似微信朋友圈的企业内部社交功能，支持内容发布、点赞、评论等交互</td>
</tr>
<tr>
<td>智能置顶</td>
<td>基于点赞数的自动置顶算法，24小时内点赞数超过10的内容参与排名，前3名自动置顶</td>
</tr>
<tr>
<td>JWT</td>
<td>JSON Web Token，用于分布式系统中的用户身份验证和授权的令牌标准</td>
</tr>
<tr>
<td>QPS</td>
<td>Queries Per Second，系统每秒处理的查询请求数量，衡量系统吞吐能力的关键指标</td>
</tr>
<tr>
<td>分库分表</td>
<td>数据库水平拆分策略，按照特定规则将数据分布到多个数据库或表中</td>
</tr>
<tr>
<td>读写分离</td>
<td>数据库架构模式，写操作在主库执行，读操作在从库执行，提升并发性能</td>
</tr>
<tr>
<td>分布式锁</td>
<td>在分布式环境中实现互斥访问的机制，防止并发操作导致的数据不一致</td>
</tr>
<tr>
<td>Feed流</td>
<td>用户动态流，按时间或算法排序展示的内容列表</td>
</tr>
<tr>
<td>缓存击穿</td>
<td>缓存失效时大量请求同时访问数据库的现象</td>
</tr>
<tr>
<td>缓存雪崩</td>
<td>大量缓存同时失效导致数据库压力激增的现象</td>
</tr>
<tr>
<td>热点数据</td>
<td>访问频率高的数据，需要特殊的缓存和优化策略</td>
</tr>
</tbody></table>
<h3 id="5-2-参考资料"><a href="#5-2-参考资料" class="headerlink" title="5.2 参考资料"></a>5.2 参考资料</h3><p>****技术框架文档****：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://gin-gonic.com/docs/">Gin Web Framework 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://golang.org/doc/">Go语言官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/">MySQL 8.0 官方参考手册</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/documentation">Redis 官方文档</a></li>
</ol>
<p>****架构设计参考****：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://microservices.io/patterns/">微服务架构设计模式</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/donnemartin/system-design-primer">高并发系统设计原理</a></li>
<li><a target="_blank" rel="noopener" href="https://patterns.arc42.org/">分布式系统设计模式</a></li>
</ol>
<p>****数据库设计参考****：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/mysql-ha-scalability/en/">MySQL 高可用架构设计</a></li>
<li><a target="_blank" rel="noopener" href="https://shardingsphere.apache.org/document/current/cn/overview/">数据库分库分表实践</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/cluster-tutorial">Redis 集群架构指南</a></li>
</ol>
<p>****API设计规范****：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://restfulapi.net/">RESTful API 设计指南</a></li>
<li><a target="_blank" rel="noopener" href="https://swagger.io/specification/">OpenAPI 3.0 规范</a></li>
<li><a target="_blank" rel="noopener" href="https://httpstatuses.com/">HTTP状态码规范</a></li>
</ol>
<p>****安全设计参考****：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://jwt.io/introduction/">JWT 官方规范文档</a></li>
<li><a target="_blank" rel="noopener" href="https://owasp.org/www-project-api-security/">OWASP API安全指南</a></li>
<li><a target="_blank" rel="noopener" href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html">密码安全最佳实践</a></li>
</ol>
<p>****性能优化参考****：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/dgryski/go-perfbook">Go语言性能优化实践</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cache-aside">缓存设计模式</a></li>
<li><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/load_balancing.html">负载均衡策略</a></li>
</ol>
<hr>
<p>****文档版本****：v1.1</p>
<p>****编写日期****：2024-12-19</p>
<p>****最后更新****：2024-12-19</p>
<p>****文档状态****：待评审</p>
<p>****架构师****：系统架构团队</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    打赏一下
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="jianing dai 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.jpg" alt="jianing dai 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Golang/" rel="tag"># Golang</a>
              <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag"># 后端开发</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/08/21/Go-Runtime/" rel="prev" title="Go Runtime">
                  <i class="fa fa-angle-left"></i> Go Runtime
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/08/28/%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99%E8%A7%84%E8%8C%83/" rel="next" title="命名规则规范">
                  命名规则规范 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">jianing dai</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jianingdai" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"jianingdai-github-io","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
